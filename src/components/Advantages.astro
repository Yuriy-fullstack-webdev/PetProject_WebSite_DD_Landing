---
import { Image } from "astro:assets";
import sound from "../assets/sound/nav-sound.mp3";
import imgDesign from "../assets/images/advantages/design-img.jpg";
import imgDev from "../assets/images/advantages/development-img.png";
import imgContent from "../assets/images/advantages/content-img.png";
import imgSeo from "../assets/images/advantages/seo-img.jpeg";
import imgSupport from "../assets/images/advantages/support-img.jpeg";


const cards = [
  {
    id: "design",
    title: "Дизайн",
    imgSrc: imgDesign,
    tagline:
      "Ми використовуємо дизайн як потужний інструмент для створення зручних естетичних та функціональних сайтів, які вирішують проблеми користувачів, покращують взаємодію з брендом і забезпечують високу конверсію.",
    headline: "Які проблеми ми вирішуємо за допомогою дизайнерських рішень:",
    description: [
      "Неадаптивність сайту",
      "Складність у навігації",
      "Відсутність унікальності",
      "Низька залученість",
      "Низька швидкість завантаження",
      "Складність у передачі ключових повідомлень",
      "Відсутність довіри до бренду",
      "Погані показники конверсії",
    ],
  },
  {
    id: "development",
    title: "Розробка",
    imgSrc: imgDev,
    tagline:
      "Ми створюємо сайти, які вирішують ключові проблеми бізнесу: підвищують впізнаваність бренду, залучають нових клієнтів, покращують взаємодію з аудиторією, автоматизують процеси продажів, забезпечують зручність користувачів, підвищують конверсію, розширюють ринкову присутність та забезпечують конкурентну перевагу.",
    headline:
      "Ми створюємо сучасні сайти, використовуючи передові технології, які забезпечують швидкість, безпеку та інноваційність:",
    description: [
      "Javascript та Svelte.js для інтерактивних інтерфейсів",
      "RESTful API для інтеграції з іншими сервісами",
      "Node.js для швидкої back-end розробки",
      "Progressive Web Apps (PWA) для офлайн-доступу",
      "GraphQL для ефективного управління даними",
      "Автоматизоване тестування для якості коду",
      "Хмарні рішення (AWS, Google Cloud) для масштабованості",
      "SEO-оптимізація для підвищення видимості",
    ],
  },
  {
    id: "content",
    title: "Контент-стратегія",
    imgSrc: imgContent,
    tagline:
      "Ми розробляємо продумані та ефективні контент-стратегії, які вирішують ключові завдання бізнесу: допомагають підвищити впізнаваність бренду, залучити нових клієнтів, покращити взаємодію з аудиторією, автоматизувати процеси продажів, забезпечити зручність користувачів, підвищити конверсію, розширити ринкову присутність та здобути конкурентну перевагу.",
    headline:
      "Ми створюємо ефективні контент-плани, використовуючи передові підходи, які забезпечують актуальність, цінність та ефективність:",
    description: [
      "Аналіз аудиторії та конкурентів для формування УТП",
      "Копірайтинг для залучення та утримання уваги ",
      "Визначення ключових повідомлень та ToV бренду",
      "Створення мультимедійного контенту (зображення, відео)",
      "Створення контент-плану для систематичної публікації",
      "Аналітика ефективності контенту",
      "SEO-оптимізація контенту для підвищення видимості",
      "Інтеграція контенту з маркетинговими та РК",
    ],
  },
  {
    id: "seo",
    title: "SEO-оптимізація",
    imgSrc: imgSeo,
    tagline:
      "Ми проводимо SEO-оптимізацію, яка вирішує ключові завдання бізнесу: підвищує видимість бренду, залучає органічний трафік, покращує позиції в пошуковій видачі, автоматизує процеси просування, забезпечує високу якість трафіку, підвищує конверсію, розширює ринкову присутність та забезпечує довгострокову конкурентну перевагу.",
    headline: "Ми використовуємо сучасні SEO-інструменти, що забезпечують ефективність, точність та інноваційність:",
    description: [
      "Технічний аудит сайту для виявлення помилок",
      "Аналіз конкурентів для виявлення нових можливостей",
      "Збір та аналіз семантичного ядра для релевантності",
      "Оптимізація швидкості завантаження",
      "Внутрішня оптимізація (метатеги, структура URL і т.д)",
      "Налаштування аналітики (Google Analytics, Search Console)",
      "Робота з зовнішніми посиланнями",
      "Регулярна звітність про досягнуті результати",
    ],
  },
  {
    id: "support",
    title: "Підтримка",
    imgSrc: imgSupport,
    tagline:
      "Ми надаємо комплексну технічну підтримку, яка вирішує ключові питання після запуску сайту: забезпечує стабільну роботу, оперативне виправлення помилок, оновлення системи, що покращує взаємодію з аудиторією, автоматизує процеси оновлень, забезпечує безперебійність роботи, підвищує безпеку, розширює функціонал та забезпечує довгострокову конкурентну перевагу.",
    headline:
      "Ми надаємо підтримку, використовуючи передові інструменти, які забезпечують швидкість, безпеку та інноваційність:",
    description: [
      "Технічний аудит сайту для виявлення та усунення проблем",
      "Аналіз та усунення вразливостей для підвищення безпеки",
      "Оновлення системи управління контентом (CMS) та плагінів",
      "Оптимізація швидкості завантаження сторінок сайту",
      "Моніторинг роботи сайту для швидкого реагування",
      "Консультування та навчання щодо роботи з сайтом",
      "Створення регулярних резервних копій для захисту даних",
      "Доопрацювання та розширення функціоналу за запитом",
    ],
  },
];
---

<section id="advantages" class="advantages" aria-labelledby="advantages-title">
  <div class="container">
    <header class="header-block header-block--center" data-color="black">
      <p class="header-supertitle">Наші переваги</p>
      <h2 class="header-title title-h2" id="advantages-title">
        Креатив<span class="dot">.&ensp;</span>Результат<span class="dot">.&ensp;</span>Інновації<span class="dot"
          >.&ensp;</span
        >
      </h2>
      <p class="header-subtitle">
        Ми завжди маємо для вас свіжі ідеї та сучасний погляд на дизайн. Наші пріоритети - це гнучкі ціни та
        індивідуальний підхід до кожного клієнта. Ми використовуємо новітні технології для максимальної ефективності та
        орієнтуємось на результат. Працюючи, ми повністю віддаємось вашому проекту.
      </p>
    </header>
    <main>
      <nav class="nav">
        <ul class="nav-list" role="tablist" aria-label="Навігація">
          {
            cards.map((item, idx) => (
              <li class={`nav-item ${idx === 0 ? "nav-item--activ" : ""}`} role="presentation">
                <button
                  class="nav-item__button"
                  role="tab"
                  id={`tab-${item.id}`}
                  aria-controls={`panel-${item.id}`}
                  aria-selected={idx === 0 ? "true" : "false"}
                  tabindex={idx === 0 ? "0" : "-1"}
                >
                  {item.title}
                </button>
              </li>
            ))
          }
        </ul>
        <audio
          class="nav-sound--hover"
          src={sound}
          preload="metadata"
          aria-label="Звуковий ефект мяу при наведенні на елемент навігації"
        >
          Ваш браузер не поддерживает audio на HTML5.
        </audio>
      </nav>
      <section class="cards">
        {
          cards.map((card, idx) => (
            <div
              class="card"
              role="tabpanel"
              id={`panel-${card.id}`}
              aria-labelledby={`tab-${card.id}`}
              tabindex={idx === 0 ? "0" : "-1"}
              hidden={idx === 0 ? undefined : true}
            >
              <div class="card-img">
                <div class="card-img__img-box">
                  <Image
                    class="card-img__img-box__image"
                    src={card.imgSrc}
                    alt={card.title}
                    width={383}
                    height={383}
                  />
                </div>
              </div>
              <div class="card-content">
                <h3 class="card-content__title title-h3">{card.title}</h3>
                <p class="card-content__tagline">{card.tagline}</p>
                <div class="card-desc">
                  <p class="card-desc__headline">{card.headline}</p>
                  <ul class="desc-list">
                    {card.description.map((description) => (
                      <li class="desc-item">{description}</li>
                    ))}
                  </ul>
                </div>
              </div>
            </div>
          ))
        }
      </section>
    </main>
  </div>
  <section class="advantages-pattern" aria-hidden="true">
    <div class="advantages-pattern__wrap">
      <div class="advantages-pattern__parallelogram"></div>
      <div class="advantages-pattern__parallelogram2 figure637-119"></div>
    </div>
  </section>
</section>

<script>
  const buttons: NodeListOf<HTMLButtonElement> = document.querySelectorAll(".nav-item__button");
  const audio: HTMLAudioElement | null = document.querySelector(".nav-sound--hover");
  let audioEnabled = false;
  //Проверяем, существует ли аудиоэлемент
  if (!audio) {
    console.error("Audio element with class '.nav-sound--hover' not found. Sound feature disabled.");
  } else {
    document.addEventListener( "click", () => {
        audioEnabled = true; },
      { once: true }
    );
    buttons.forEach((button: HTMLButtonElement) => {
      button.addEventListener("mouseenter", (): void => {
        if (audioEnabled) {
          // Відтворюємо, тільки якщо користувач вже клікав
          audio.currentTime = 0;
          audio.volume = 0.1;
          audio.play().catch((error) => {
            console.warn("Audio playback initiated by mouseenter failed:", error);
          });
        }
      });

      button.addEventListener("mouseleave", (): void => {
        audio.pause();
        audio.currentTime = 0;
      });
    });
  }

  const navActiv = document.querySelector(".nav-item--activ");
  const navList = document.querySelectorAll(".nav-item");
  const cardList = document.querySelectorAll('.card[role="tabpanel"]');

  navList.forEach((item) =>
    item.addEventListener("click", () => {
      // 1. Сначала удаляем активный класс со ВСЕХ элементов в navList
      navList.forEach((navItem) => {
        navItem.classList.remove("nav-item--activ");
      });
      // 2. Добавляем активный класс ТОЛЬКО к элементу, на который нажали (item)
      item.classList.add("nav-item--activ");
    })
  );

  buttons.forEach((button) => {
    let actibTabId = "";
    button.addEventListener("click", () => {
      // 1. Сброс ВСЕХ кнопок: Делаем их неактивными
      buttons.forEach((otherButton) => {
        otherButton.setAttribute("aria-selected", "false");
        otherButton.setAttribute("tabindex", "0");
      });

      // 2. Активация нажатой кнопки: Делаем ЕЁ активной
      // Устанавливаем aria-selected в 'true' (активно) tabindex в '-1'
      button.setAttribute("aria-selected", "true");
      button.setAttribute("tabindex", "-1");

      actibTabId = button.id;

      cardList.forEach((card) => {
        card.setAttribute("hidden", "");
        card.setAttribute("tabindex", "-1");
        let cardId = card.getAttribute("aria-labelledby");
        if (cardId === actibTabId) {
          card.removeAttribute("hidden");
          card.setAttribute("tabindex", "0");
        }
      });
    });
  });
</script>

<style>
  .card[hidden] {
    display: none;
  }

  .advantages {
    position: relative;
    padding-top: 120px;
    padding-bottom: 60px;
    background-color: var(--bg-secondary);
  }

  .header-block {
    letter-spacing: var(--spacing-s);
  }

  .header-block--left :is(p, h2) {
    text-align: left;
  }

  .header-block--center :is(p, h2) {
    text-align: center;
  }

  .header-supertitle {
    font-weight: 500;
    font-size: var(--font-size-20-16);
  }

  .header-title {
    margin-top: 1.5rem;
    margin-bottom: 2.5rem;
  }

  .header-subtitle {
    font-weight: 400;
    font-size: var(--font-size-18-16);
  }

  [data-color="black"] .header-supertitle {
    color: var(--text-accent5);
  }

  [data-color="black"] .header-title {
    color: var(--text-primary);
  }

  [data-color="black"] .header-subtitle {
    color: var(--text-dark-3);
  }

  .dot {
    color: var(--text-accent2);
  }

  /** main */
  .nav {
    margin: 64px 0;
    border-bottom: 1px dashed rgba(37, 34, 55, 0.2);
  }

  .nav-list {
    --padding-button-block: 6px;
    --padding-button-line: 1px;
    --margin-bottom: 15px;
    --margin-line: 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 0 var(--margin-line) var(--margin-bottom);
  }

  .nav-item {
    position: relative;
    max-width: max-content;
  }

  .nav-item--activ:after {
    content: "";
    display: block;
    position: absolute;
    bottom: calc((var(--margin-bottom) + var(--padding-button-line)) * (-1));
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% + 2 * var(--margin-line));
    height: 2px;
    transition: width 0.5s;
    background-color: var(--hover-accent5);
  }

  .nav-item__button {
    position: relative;
    color: rgba(37, 34, 55, 0.5);

    font-family: Lato;
    font-size: 20px;
    font-weight: 400;
    line-height: 24px;
    letter-spacing: 0px;
    text-align: center;

    padding: var(--padding-button-line) var(--padding-button-block);
    cursor: pointer;
    background-color: transparent;
    border: transparent;
  }

  .nav-item__button:hover {
    color: var(--hover-accent5);
  }

  .nav-item__button:after {
    content: "";
    display: block;
    position: absolute;
    bottom: calc((var(--margin-bottom) + var(--padding-button-line)) * (-1));
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 2px;
    transition: width 1s;
    background-color: var(--hover-primary-opacity);
  }
  .nav-item__button:hover:after {
    content: "";
    display: block;
    position: absolute;
    bottom: calc((var(--margin-bottom) + var(--padding-button-line)) * (-1));
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% + 2 * var(--margin-line));
    height: 2px;
    /* bottom: var(--margin-bottom); */
    transition: width 0.5s;
    background-color: var(--hover-accent5);
  }

  .cards {
    position: relative;
    z-index: 1;
  }
  .card {
    display: flex;
    justify-content: space-between;
    align-items: stretch;
    column-gap: calc(var(--gap-base) * 3);
    min-height: 506px;
    height: 100%;

    padding: 24px 16px 24px 16px;

    box-shadow: 0px 4px 16px 0px rgba(0, 0, 0, 0.25);
    background: rgba(255, 255, 255, 1);
  }

  .card-img {
    align-self: center;
    position: relative;

    max-width: 435px;
    min-width: 320px; /*** ПОКА НА ГЛАЗ  */
    width: 100%;
    height: 100%;
    aspect-ratio: 1;

    display: flex;
    justify-content: center;
    align-items: center;

    box-sizing: border-box;
    border: 1px dashed rgba(37, 34, 55, 0.7);
    border-radius: 50%;
  }

  .card-img__img-box {
    width: 88%;
    aspect-ratio: 1;
    border-radius: 50%;
    overflow: hidden;
  }

  .card-img__img-box__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .card-content {
    display: flex;
    flex-direction: column;
    max-width: 546px;
    max-height: 100%;
    row-gap: var(--gap-base);
    justify-content: space-between;
  }
  .card-content__title {
    color: var(--text-accent5);
  }
  .card-content__tagline {
    color: var(--text-dark-3);

    font-size: 16px;
    font-weight: 600;
    line-height: 19px;
    letter-spacing: 0px;
    text-align: left;
  }
  .card-desc {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    letter-spacing: 0px;
    text-align: left;
  }
  .card-desc__headline {
    color: var(--text-dark-3);

    font-size: 16px;
    font-weight: 400;
    line-height: 19px;
    margin-bottom: 16px;
  }
  .desc-list {
    flex-grow: 1;
    display: grid;
    justify-content: space-between;
    align-items: center;
    grid-template-columns: repeat(2, minmax(auto, 248px));
    grid-auto-rows: minmax(34px, auto);
    gap: var(--gap-base);
  }
  .desc-item {
    position: relative;
    color: var(--text-dark-3);

    font-size: 14px;
    font-weight: 300;
    line-height: 19px;
    font-style: italic;

    padding-left: 38px;
  }

  .desc-item::before {
    content: "";
    position: absolute;
    left: 0;
    top: 50%; /* Центрируем по вертикали */
    transform: translateY(-50%);

    width: 22px;
    height: 22px;

    background-image: url("../icons/icon-ball-2.svg");
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
  }

  /**advantages-pattern */
  .advantages-pattern {
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 35.5%;
    background-color: var(--bg-white);
  }
  .advantages-pattern__wrap {
    position: relative;
    width: 100%;
    height: 100%;
  }
  .advantages-pattern__parallelogram {
    width: 100%;
    height: 100%;
    clip-path: polygon(0 7%, 100% 0, 100% 49%, 0 76%);
    background-color: var(--bg-shape3);
    margin-top: -2.28%;
  }

  .advantages-pattern__parallelogram2 {
    position: absolute;
    top: -32px; /** 3 */
    right: 2%;
    background: linear-gradient(231.49deg, rgba(116, 108, 245, 0.19), rgba(116, 108, 245, 0) 100%);
    clip-path: polygon(0 38%, 100% 0, 97% 65%, 0 100%);
  }

  @media (max-width: 767px) {
    .header-supertitle,
    .header-subtitle {
      line-height: var(--line-height-s);
    }
  }
</style>
